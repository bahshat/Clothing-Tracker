{% extends 'production_tracker/base.html' %}

{% block content %}
    <h1>Dashboard</h1>
    <p>Welcome to your Clothing Production Tracker dashboard!</p>
    
    <div class="dashboard-section">
        <h2>Order Overview</h2>
        <div class="analytics-cards">
            <div class="card">
                <h3>Total Orders</h3>
                <p>{{ total_orders }}</p>
            </div>
            <div class="card">
                <h3>Pending Orders</h3>
                <p>{{ pending_orders }}</p>
            </div>
            <div class="card">
                <h3>In Progress Orders</h3>
                <p>{{ in_progress_orders }}</p>
            </div>
            <div class="card">
                <h3>Completed Orders</h3>
                <p>{{ completed_orders }}</p>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="orderStatusChart"></canvas>
        </div>

        <h2>Recent Orders</h2>
        {% if recent_orders %}
            <table>
                <thead>
                    <tr>
                        <th>Order Number</th>
                        <th>Customer</th>
                        <th>Order Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in recent_orders %}
                        <tr>
                            <td><a href="{% url 'order_detail' order.pk %}">{{ order.order_number }}</a></td>
                            <td>{{ order.customer.name }}</td>
                            <td>{{ order.order_date }}</td>
                            <td>{{ order.status }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No recent orders to display.</p>
        {% endif %}
    </div>

    <div class="dashboard-section">
        <h2>Vendor & Individual Overview</h2>
        <div class="analytics-cards">
            <div class="card">
                <h3>Total Vendors</h3>
                <p>{{ total_vendors }}</p>
            </div>
            <div class="card">
                <h3>Total Individuals</h3>
                <p>{{ total_individuals }}</p>
            </div>
        </div>
    </div>

    <div class="dashboard-section">
        <h2>Invoice Overview</h2>
        <div class="analytics-cards">
            <div class="card">
                <h3>Total Invoiced Amount</h3>
                <p>${{ total_invoice_amount|floatformat:2 }}</p>
            </div>
            <div class="card">
                <h3>Paid Invoices</h3>
                <p>{{ paid_invoices }}</p>
            </div>
            <div class="card">
                <h3>Unpaid Invoices</h3>
                <p>{{ unpaid_invoices }}</p>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="invoiceStatusChart"></canvas>
        </div>
    </div>

    <div class="dashboard-section">
        <h2>Production Stages</h2>
        <div class="analytics-cards">
            <div class="card">
                <h3>Stages In Progress</h3>
                <p>{{ stages_in_progress }}</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Data from Django context
        const pendingOrders = {{ pending_orders }};
        const inProgressOrders = {{ in_progress_orders }};
        const completedOrders = {{ completed_orders }};

        const paidInvoices = {{ paid_invoices }};
        const unpaidInvoices = {{ unpaid_invoices }};

        // Order Status Chart
        const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
        new Chart(orderStatusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Pending', 'In Progress', 'Completed'],
                datasets: [{
                    data: [pendingOrders, inProgressOrders, completedOrders],
                    backgroundColor: [
                        '#cb4b16', // Terracotta
                        '#268bd2', // Bright Blue
                        '#2aa198'  // Teal
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Order Status Distribution',
                        color: '#073642'
                    },
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#586e75'
                        }
                    }
                }
            }
        });

        // Invoice Status Chart
        const invoiceStatusCtx = document.getElementById('invoiceStatusChart').getContext('2d');
        new Chart(invoiceStatusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Paid', 'Unpaid'],
                datasets: [{
                    data: [paidInvoices, unpaidInvoices],
                    backgroundColor: [
                        '#2aa198', // Teal
                        '#dc322f'  // Red
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Invoice Status Distribution',
                        color: '#073642'
                    },
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#586e75'
                        }
                    }
                }
            }
        });
    </script>
{% endblock %}
